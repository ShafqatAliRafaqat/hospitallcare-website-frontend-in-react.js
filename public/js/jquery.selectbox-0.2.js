!function(e,s){var t=!0;function i(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}e.extend(i.prototype,{_isOpenSelectbox:function(e){return!!e&&this._getInst(e).isOpen},_isDisabledSelectbox:function(e){return!!e&&this._getInst(e).isDisabled},_attachSelectbox:function(s,i){if(this._getInst(s))return!1;var a,n,l,o,c=e(s),d=this,r=d._newInst(c),u=!1,b=(c.find("optgroup"),c.find("option")),p=b.length;function g(){var s,t,i=this.attr("id").split("_")[1];for(s in d._state)s!==i&&d._state.hasOwnProperty(s)&&(t=e("select[sb='"+s+"']")[0])&&d._closeSelectbox(t)}function f(){var i=!(!arguments[1]||!arguments[1].sub),a=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(c){var b,g=e(this),f=e("<li>");g.is(":selected")&&(n.text(g.text()),u=t),c===p-1&&f.addClass("last"),g.is(":disabled")||a?(b=e("<span>",{text:g.text()}).addClass(r.settings.classDisabled),i&&b.addClass(r.settings.classSub),b.appendTo(f)):(b=e("<a>",{href:"#"+g.val(),rel:g.val()}).text(g.text()).bind("click.sb",function(t){t&&t.preventDefault&&t.preventDefault();var i=l,a=e(this);i.attr("id").split("_")[1];d._changeSelectbox(s,a.attr("rel"),a.text()),d._closeSelectbox(s)}).bind("mouseover.sb",function(){var s=e(this);s.parent().siblings().find("a").removeClass(r.settings.classFocus),s.addClass(r.settings.classFocus)}).bind("mouseout.sb",function(){e(this).removeClass(r.settings.classFocus)}),i&&b.addClass(r.settings.classSub),g.is(":selected")&&b.addClass(r.settings.classFocus),b.appendTo(f)),f.appendTo(o)})}c.attr("sb",r.uid),e.extend(r.settings,d._defaults,i),d._state[r.uid]=!1,c.hide(),a=e("<div>",{id:"sbHolder_"+r.uid,class:r.settings.classHolder,tabindex:c.attr("tabindex")}),n=e("<a>",{id:"sbSelector_"+r.uid,href:"#",class:r.settings.classSelector,click:function(t){t.preventDefault(),g.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];d._state[i]?d._closeSelectbox(s):d._openSelectbox(s)}}),(l=e("<a>",{id:"sbToggle_"+r.uid,href:"#",class:r.settings.classToggle,click:function(t){t.preventDefault(),g.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];d._state[i]?d._closeSelectbox(s):d._openSelectbox(s)}})).appendTo(a),o=e("<ul>",{id:"sbOptions_"+r.uid,class:r.settings.classOptions,css:{display:"none"}}),c.children().each(function(s){var t,i=e(this),a={};i.is("option")?f(i):i.is("optgroup")&&(t=e("<li>"),e("<span>",{text:i.attr("label")}).addClass(r.settings.classGroup).appendTo(t),t.appendTo(o),i.is(":disabled")&&(a.disabled=!0),a.sub=!0,f(i.find("option"),a))}),u||n.text(b.first().text()),e.data(s,"selectbox",r),a.data("uid",r.uid).bind("keydown.sb",function(s){var t=s.charCode?s.charCode:s.keyCode?s.keyCode:0,i=e(this),a=i.data("uid"),n=i.siblings("select[sb='"+a+"']").data("selectbox"),l=i.siblings(["select[sb='",a,"']"].join("")).get(0),o=i.find("ul").find("a."+n.settings.classFocus);switch(t){case 37:case 38:if(o.length>0)e("a",i).removeClass(n.settings.classFocus),(c=o.parent().prevAll("li:has(a)").eq(0).find("a")).length>0&&(c.addClass(n.settings.classFocus).focus(),e("#sbSelector_"+a).text(c.text()));break;case 39:case 40:var c;e("a",i).removeClass(n.settings.classFocus),(c=o.length>0?o.parent().nextAll("li:has(a)").eq(0).find("a"):i.find("ul").find("a").eq(0)).length>0&&(c.addClass(n.settings.classFocus).focus(),e("#sbSelector_"+a).text(c.text()));break;case 13:o.length>0&&d._changeSelectbox(l,o.attr("rel"),o.text()),d._closeSelectbox(l);break;case 9:if(l)(n=d._getInst(l))&&(o.length>0&&d._changeSelectbox(l,o.attr("rel"),o.text()),d._closeSelectbox(l));var r=parseInt(i.attr("tabindex"),10);s.shiftKey?r--:r++,e("*[tabindex='"+r+"']").focus();break;case 27:d._closeSelectbox(l)}return s.stopPropagation(),!1}).delegate("a","mouseover",function(s){e(this).addClass(r.settings.classFocus)}).delegate("a","mouseout",function(s){e(this).removeClass(r.settings.classFocus)}),n.appendTo(a),o.appendTo(a),a.insertAfter(c),e([".",r.settings.classHolder,", .",r.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(s){var t=this._getInst(s);if(!t)return!1;e("#sbHolder_"+t.uid).remove(),e.data(s,"selectbox",null),e(s).show()},_changeSelectbox:function(s,i,a){var n,l=this._getInst(s);l&&(n=this._get(l,"onChange"),e("#sbSelector_"+l.uid).text(a)),i=i.replace(/\'/g,"\\'"),e(s).find("option[value='"+i+"']").attr("selected",t),l&&n?n.apply(l.input?l.input[0]:null,[i,l]):l&&l.input&&l.input.trigger("change")},_enableSelectbox:function(s){var t=this._getInst(s);if(!t||!t.isDisabled)return!1;e("#sbHolder_"+t.uid).removeClass(t.settings.classHolderDisabled),t.isDisabled=!1,e.data(s,"selectbox",t)},_disableSelectbox:function(s){var i=this._getInst(s);if(!i||i.isDisabled)return!1;e("#sbHolder_"+i.uid).addClass(i.settings.classHolderDisabled),i.isDisabled=t,e.data(s,"selectbox",i)},_optionSelectbox:function(s,t,i){var a=this._getInst(s);if(!a)return!1;a[t]=i,e.data(s,"selectbox",a)},_openSelectbox:function(s){var i=this._getInst(s);if(i&&!i.isOpen&&!i.isDisabled){var a=e("#sbOptions_"+i.uid),n=parseInt(e(window).height(),10),l=e("#sbHolder_"+i.uid).offset(),o=e(window).scrollTop(),c=a.prev().height(),d=n-(l.top-o)-c/2,r=this._get(i,"onOpen");a.css({top:c+"px",maxHeight:d-c+"px"}),"fade"===i.settings.effect?a.fadeIn(i.settings.speed):a.slideDown(i.settings.speed),e("#sbToggle_"+i.uid).addClass(i.settings.classToggleOpen),this._state[i.uid]=t,i.isOpen=t,r&&r.apply(i.input?i.input[0]:null,[i]),e.data(s,"selectbox",i)}},_closeSelectbox:function(s){var t=this._getInst(s);if(t&&t.isOpen){var i=this._get(t,"onClose");"fade"===t.settings.effect?e("#sbOptions_"+t.uid).fadeOut(t.settings.speed):e("#sbOptions_"+t.uid).slideUp(t.settings.speed),e("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),this._state[t.uid]=!1,t.isOpen=!1,i&&i.apply(t.input?t.input[0]:null,[t]),e.data(s,"selectbox",t)}},_newInst:function(e){return{id:e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:e,uid:Math.floor(99999999*Math.random()),isOpen:!1,isDisabled:!1,settings:{}}},_getInst:function(s){try{return e.data(s,"selectbox")}catch(e){throw"Missing instance data for this selectbox"}},_get:function(e,s){return void 0!==e.settings[s]?e.settings[s]:this._defaults[s]}}),e.fn.selectbox=function(s){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):this.each(function(){"string"==typeof s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this].concat(t)):e.selectbox._attachSelectbox(this,s)})},e.selectbox=new i,e.selectbox.version="0.2"}(jQuery);